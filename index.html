<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏±‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á (Responsive)</title>
    <style>
        /* --- 1. ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡∏ô‡∏≤‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f0f8ff; 
            color: #343a40;
        }

        h1, h2 {
            text-align: center;
            color: #1976d2;
            margin-top: 10px;
        }

        /* --- ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï --- */
        #controlHeader {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap; /* ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏á‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏•‡πá‡∏Å */
        }
        
        #resetButton, #historyButton {
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #resetButton { background-color: #ffc107; color: #343a40; }
        #historyButton { background-color: #6c757d; color: white; }

        /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --- */
        #statusTable {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            overflow: hidden;
            margin: 0 auto; /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ö‡∏ô‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà */
            max-width: 900px; /* ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î */
        }

        #statusTable th, #statusTable td {
            border: 1px solid #dee2e6;
            padding: 10px;
            text-align: left;
            vertical-align: middle;
        }

        #statusTable th {
            background-color: #007bff;
            color: white;
            text-align: center;
            font-weight: 600;
        }
        
        /* ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
        #statusTable td:nth-child(4),
        #statusTable td:nth-child(5),
        #statusTable td:nth-child(6),
        #statusTable td:nth-child(7) { 
            text-align: center;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        .lunch-button {
            padding: 5px 8px;
            font-size: 0.85em; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
            border-radius: 4px;
            color: white;
            cursor: pointer;
            width: 100px; /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            white-space: nowrap; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ï‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
        }
        
        .btn-go { background-color: #dc3545; } 
        .btn-back { background-color: #28a745; } 
        
        /* --- ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) --- */
        .dept-sausage { background-color: #ffe0e0; }
        .dept-sushi { background-color: #e0f0ff; }
        .dept-veggie { background-color: #e0ffec; }
        .dept-bakery { background-color: #fffbe0; }
        .dept-dairy { background-color: #f0e0ff; }
        .dept-meat { background-color: #ffc2c2; }
        .dept-seafood { background-color: #e0fff9; }
        
        /* ‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏µ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
        .dept-sausage:nth-child(odd) { background-color: #ffd0d0; } 
        .dept-sushi:nth-child(odd) { background-color: #c8e8ff; } 
        .dept-veggie:nth-child(odd) { background-color: #c8ffe0; } 
        .dept-bakery:nth-child(odd) { background-color: #fff5c8; } 
        .dept-dairy:nth-child(odd) { background-color: #e8d0ff; }
        .dept-meat:nth-child(odd) { background-color: #ffadad; }
        .dept-seafood:nth-child(odd) { background-color: #c8fff5; }

        /* --- Modal Styles (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á) --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); padding-top: 20px;}
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 600px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto;}
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
        .close:hover, .close:focus { color: #000; text-decoration: none; cursor: pointer; }
        #historyContent pre { white-space: pre-wrap; background-color: #eee; padding: 15px; border-radius: 4px; font-size: 0.85em; }
        
        /* ========================================================== */
        /* --- 2. MEDIA QUERY: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å (Mobile) --- */
        /* ========================================================== */
        @media screen and (max-width: 768px) {
            
            body {
                padding: 5px;
                font-size: 14px; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏° */
            }

            /* --- ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö "‡∏ö‡∏±‡∏ï‡∏£" (Card View) --- */
            #statusTable, #statusTable thead, #statusTable tbody, #statusTable th, #statusTable td, #statusTable tr {
                display: block; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô Block Level */
            }

            #statusTable thead tr {
                position: absolute; /* ‡∏ã‡πà‡∏≠‡∏ô Header (‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á) */
                top: -9999px;
                left: -9999px;
            }

            #statusTable tr {
                border: 1px solid #ccc;
                margin-bottom: 10px;
                border-radius: 6px;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }

            #statusTable td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Label */
                text-align: right !important; /* ‡∏à‡∏±‡∏î‡∏ä‡∏¥‡∏î‡∏Ç‡∏ß‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö */
                font-size: 1em;
            }

            #statusTable td:before {
                /* ‡πÄ‡∏û‡∏¥‡πà‡∏° Label/Header ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÅ‡∏ó‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
                position: absolute;
                top: 0;
                left: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                text-align: left;
                font-weight: bold;
                color: #555;
            }

            /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Label (‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå) ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Cell */
            #statusTable tr td:nth-of-type(1):before { content: "‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô"; }
            #statusTable tr td:nth-of-type(2):before { content: "‡πÅ‡∏ú‡∏ô‡∏Å"; }
            #statusTable tr td:nth-of-type(3):before { content: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞"; }
            #statusTable tr td:nth-of-type(4):before { content: "‡πÑ‡∏õ‡∏û‡∏±‡∏Å"; }
            #statusTable tr td:nth-of-type(5):before { content: "‡∏Å‡∏•‡∏±‡∏ö"; }
            #statusTable tr td:nth-of-type(6):before { content: "‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å"; }
            #statusTable tr td:nth-of-type(7):before { content: "‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°"; }
            
            /* ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô Card View */
            #statusTable tr td:nth-of-type(7) {
                text-align: left !important;
                padding-left: 6px;
                background-color: inherit;
            }
            #statusTable tr td:nth-of-type(7):before {
                display: none; /* ‡∏ã‡πà‡∏≠‡∏ô Label '‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°' */
            }
            .lunch-button {
                width: 90%; /* ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>

    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏±‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h1>

    <div id="controlHeader">
        <button id="resetButton" onclick="resetAllStatusesWithCode()">
            ‚ö†Ô∏è ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô)
        </button>
        <button id="historyButton" onclick="showHistory()">
            üìö ‡∏î‡∏π‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
        </button>
    </div>
    
    <h2>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <table id="statusTable">
        <thead>
            <tr>
                <th>‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</th>
                <th>‡πÅ‡∏ú‡∏ô‡∏Å</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏õ‡∏û‡∏±‡∏Å</th>
                <th>‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏±‡∏ö</th>
                <th>‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å</th>
                <th>‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°</th> 
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <div id="historyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï)</h2>
            <div id="historyContent">
                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>
            </div>
        </div>
    </div>

    <script>
        // --- ‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏á‡∏ó‡∏µ‡πà ---
        const EMPLOYEES_DATA = [
            { id: 'sausage_1', name: '‡∏£‡∏ß‡∏¥‡∏ß‡∏£‡∏£‡∏ì ‡∏ä‡∏≥‡∏ô‡∏≤‡∏ô‡πÄ‡∏û‡∏≤‡∏∞', dept: '‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å-‡πÅ‡∏Æ‡∏°', class: 'dept-sausage' },
            { id: 'sausage_2', name: '‡∏û‡∏±‡∏ä‡∏£‡∏µ ‡∏™‡∏∏‡∏Ç‡πÅ‡∏™‡∏ß‡∏á', dept: '‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å-‡πÅ‡∏Æ‡∏°', class: 'dept-sausage' },
            { id: 'sushi_1', name: '‡∏®‡∏¥‡∏£‡∏¥‡∏ò‡∏£ ‡∏ä‡∏±‡∏¢‡πÄ‡∏ß‡∏ó‡∏¢‡πå', dept: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô', class: 'dept-sushi' },
            { id: 'sushi_2', name: '‡∏ò‡∏µ‡∏£‡∏ß‡∏±‡∏í‡∏ô‡πå ‡∏ö‡∏±‡∏ß‡πÅ‡∏Å‡πâ‡∏ß', dept: '‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ç‡∏µ‡πà‡∏õ‡∏∏‡πà‡∏ô', class: 'dept-sushi' },
            { id: 'veggie_1', name: '‡∏Æ‡∏≤‡∏ö‡∏µ‡∏ö‡∏∞ ‡πÇ‡∏î‡πÇ‡∏ã‡∏°‡∏¥', dept: '‡∏ú‡∏±‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ', class: 'dept-veggie' },
            { id: 'veggie_2', name: '‡∏°‡∏≤‡∏£‡∏µ‡∏ô‡∏≤ ‡∏î‡∏±‡πâ‡∏ô‡∏î‡∏µ', dept: '‡∏ú‡∏±‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ', class: 'dept-veggie' },
            { id: 'bakery_1', name: '‡∏™‡∏£‡∏¥‡∏ô‡∏¢‡∏≤ ‡∏™‡∏≤‡∏£‡∏¥‡∏¢‡∏≤', dept: '‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà', class: 'dept-bakery' },
            { id: 'dairy_1', name: '‡∏ô‡∏≤‡∏®‡∏£‡∏¥‡∏ç ‡πÇ‡∏°‡∏á', dept: '‡∏ô‡∏°-‡∏ä‡∏µ‡∏™', class: 'dept-dairy' },
            { id: 'dairy_2', name: '‡∏≠‡∏±‡∏™‡∏ß‡∏≤‡∏ô ‡∏≠‡∏≤‡πÅ‡∏ß', dept: '‡∏ô‡∏°-‡∏ä‡∏µ‡∏™', class: 'dept-dairy' },
            { id: 'meat_1', name: '‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏£‡∏¥‡∏ä ‡∏™‡∏°‡∏≤‡∏ô', dept: '‡πÄ‡∏ô‡∏∑‡πâ‡∏≠', class: 'dept-meat' },
            { id: 'seafood_1', name: '‡∏≠‡∏¥‡∏™‡∏°‡∏≤‡πÅ‡∏≠ ‡∏™‡∏≤‡πÄ‡∏•‡πá‡∏á', dept: '‡∏ã‡∏µ‡∏ü‡∏π‡πâ‡∏î', class: 'dept-seafood' },
        ];
        
        const LOCAL_STORAGE_KEY = 'employeeLunchStatusV4';
        const HISTORY_KEY = 'employeeLunchHistory';
        const LAST_RESET_KEY = 'lastResetDate';
        const RESET_PASSWORD = '254130'; 

        let allStatuses = {}; 

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ ---

        function formatTime(dateString) {
            if (!dateString) return '-';
            try {
                const d = new Date(dateString);
                if (isNaN(d.getTime())) return '-';
                return d.toLocaleTimeString('th-TH', { 
                    hour: '2-digit', 
                    minute: '2-digit', 
                    second: '2-digit' 
                });
            } catch (e) { return '-'; }
        }

        function calculateDuration(startTimeString, endTimeString) {
            if (!startTimeString || !endTimeString) return '-';
            
            const startDate = new Date(startTimeString);
            const endDate = new Date(endTimeString);
            
            const durationMs = endDate - startDate;
            if (durationMs < 0) return '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏ß‡∏•‡∏≤';
            
            const hours = Math.floor(durationMs / (1000 * 60 * 60));
            const minutes = Math.floor((durationMs % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((durationMs % (1000 * 60)) / 1000);
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function getTodayDateString() {
            return new Date().toISOString().split('T')[0];
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Local Storage ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á) ---
        
        function getInitialStatus() {
            return { 
                isAvailable: true, 
                lunchStart: null, 
                lunchEnd: null,
                duration: '-'
            };
        }

        function loadAllStatuses() {
            const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
            try {
                allStatuses = savedData ? JSON.parse(savedData) : {};
            } catch (e) {
                allStatuses = {};
            }
            
            EMPLOYEES_DATA.forEach(emp => {
                if (!allStatuses[emp.id]) {
                    allStatuses[emp.id] = getInitialStatus();
                }
            });
        }

        function saveAllStatuses() {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(allStatuses));
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á) ---
        
        function resetAllStatusesWithCode() {
            const inputCode = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:");
            
            if (inputCode === RESET_PASSWORD) {
                if (confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô?")) {
                    performReset(true);
                    alert("‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
                }
            } else if (inputCode !== null) {
                alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏î‡πâ");
            }
        }
        
        function performReset(isManual) {
            if (!isManual) {
                const lastResetDate = localStorage.getItem(LAST_RESET_KEY);
                if (lastResetDate === getTodayDateString()) {
                    return; 
                }
            }

            const historyRecord = {
                date: new Date().toISOString(),
                statusData: allStatuses
            };
            localStorage.setItem(HISTORY_KEY, JSON.stringify(historyRecord));

            EMPLOYEES_DATA.forEach(emp => {
                allStatuses[emp.id] = getInitialStatus();
            });
            
            saveAllStatuses();
            localStorage.setItem(LAST_RESET_KEY, getTodayDateString());
            updateTable();
        }

        function checkAutoReset() {
            const now = new Date();
            const lastResetDate = localStorage.getItem(LAST_RESET_KEY);
            
            if (lastResetDate !== getTodayDateString() && now.getHours() === 0 && now.getMinutes() === 0) {
                performReset(false);
                console.log("Auto-reset completed at 00:00.");
            }
        }
        
        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á) ---
        
        function showHistory() {
            const historyData = localStorage.getItem(HISTORY_KEY);
            const contentDiv = document.getElementById('historyContent');
            const modal = document.getElementById('historyModal');
            
            if (!historyData) {
                contentDiv.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>';
            } else {
                const record = JSON.parse(historyData);
                let historyHTML = `<h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date(record.date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</h3>`;
                historyHTML += '<pre>';
                
                EMPLOYEES_DATA.forEach(emp => {
                    const status = record.statusData[emp.id];
                    if (status) {
                        const start = formatTime(status.lunchStart);
                        const end = formatTime(status.lunchEnd);
                        const duration = status.duration;
                        const finalStatus = status.isAvailable ? '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô' : '‡∏û‡∏±‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á';

                        historyHTML += `[${emp.dept}] ${emp.name}:\n`;
                        historyHTML += `  ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢: ${finalStatus}\n`;
                        historyHTML += `  ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏±‡∏Å: ${start}\n`;
                        historyHTML += `  ‡∏Å‡∏•‡∏±‡∏ö: ${end}\n`;
                        historyHTML += `  ‡∏£‡∏ß‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å: ${duration}\n\n`;
                    }
                });
                
                historyHTML += '</pre>';
                contentDiv.innerHTML = historyHTML;
            }
            
            modal.style.display = "block"; 
        }

        function closeModal() {
            document.getElementById('historyModal').style.display = "none";
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô) ---

        function updateTable() {
            const tbody = document.querySelector('#statusTable tbody');
            tbody.innerHTML = ''; 
            
            const sortedEmployees = [...EMPLOYEES_DATA].sort((a, b) => a.dept.localeCompare(b.dept, 'th'));

            sortedEmployees.forEach(emp => {
                const status = allStatuses[emp.id];
                const row = tbody.insertRow();
                
                row.className = emp.class;

                const statusClass = status.isAvailable ? 'status-available' : 'status-lunch';
                const statusText = status.isAvailable ? '‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô' : '‡∏û‡∏±‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á';
                
                row.insertCell().textContent = emp.name;
                row.insertCell().textContent = emp.dept;
                
                const statusCell = row.insertCell();
                statusCell.className = statusClass;
                statusCell.textContent = statusText;

                row.insertCell().textContent = formatTime(status.lunchStart);
                row.insertCell().textContent = formatTime(status.lunchEnd);
                row.insertCell().textContent = status.duration;

                const controlCell = row.insertCell();
                controlCell.innerHTML = createControlButton(emp.id, status.isAvailable);
            });
        }
        
        function createControlButton(employeeId, isAvailable) {
            if (isAvailable) {
                return `<button class="lunch-button btn-go" onclick="toggleStatus('${employeeId}', false)">
                            ‚è∏Ô∏è ‡πÑ‡∏õ‡∏û‡∏±‡∏Å
                        </button>`;
            } else {
                return `<button class="lunch-button btn-back" onclick="toggleStatus('${employeeId}', true)">
                            ‚ñ∂Ô∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏û‡∏±‡∏Å
                        </button>`;
            }
        }

        // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á) ---
        
        function toggleStatus(employeeId, nextStatus) {
            const now = new Date().toISOString(); 
            let status = allStatuses[employeeId];
            
            if (status.isAvailable === nextStatus) return; 

            status.isAvailable = nextStatus; 

            if (!status.isAvailable) {
                status.lunchStart = now;
                status.lunchEnd = null; 
                status.duration = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏±‡∏Å...';
                
            } else {
                status.lunchEnd = now;
                
                if (status.lunchStart) {
                    status.duration = calculateDuration(status.lunchStart, status.lunchEnd);
                } else {
                    status.duration = 'N/A (‡∏Ç‡∏≤‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô)';
                }
            }
            
            allStatuses[employeeId] = status;
            saveAllStatuses(); 
            updateTable(); 
        }

        // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (Initialisation) ---
        
        loadAllStatuses(); 
        updateTable(); 
        
        setInterval(checkAutoReset, 60000); 
        checkAutoReset(); 

        window.onclick = function(event) {
            const modal = document.getElementById('historyModal');
            if (event.target === modal) {
                modal.style.display = "none";
            }
        }
    </script>
</body>
</html>
